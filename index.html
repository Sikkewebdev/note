<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f0f0f">
<title>Notes</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: fixed;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
  background: #0f0f0f;
  touch-action: pan-y;
  -webkit-user-select: none;
  user-select: none;
}

body {
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}

#app {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  position: relative;
}

.header {
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
  background: #0f0f0f;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.header-title {
  font-size: 32px;
  font-weight: 800;
  color: #fff;
  letter-spacing: -1px;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.note-stats {
  font-size: 13px;
  color: #888;
  padding: 6px 12px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.05);
}

.notes-scroll {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  padding: 0;
}

.notes-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
  padding: 16px 16px;
  grid-auto-rows: max-content;
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100%;
  color: #555;
  text-align: center;
  padding: 40px 20px;
  gap: 16px;
}

.empty-icon {
  font-size: 56px;
  opacity: 0.5;
}

.empty-title {
  font-size: 18px;
  font-weight: 600;
  color: #666;
}

.empty-text {
  font-size: 14px;
  color: #555;
  max-width: 260px;
}

.note-item {
  background: linear-gradient(135deg, #1a1a1a 0%, #262626 100%);
  border-radius: 14px;
  padding: 16px;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  border: 1px solid rgba(255, 255, 255, 0.08);
  position: relative;
  overflow: hidden;
  animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes popIn {
  0% {
    opacity: 0;
    transform: scale(0.92);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

.note-item:active {
  transform: scale(0.96);
  background: linear-gradient(135deg, #222 0%, #2d2d2d 100%);
}

.note-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
  pointer-events: none;
  border-radius: 14px;
}

.note-title {
  font-size: 17px;
  font-weight: 600;
  color: #fff;
  margin-bottom: 8px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  position: relative;
  z-index: 1;
}

.note-preview {
  font-size: 14px;
  color: #aaa;
  line-height: 1.4;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  margin-bottom: 10px;
  position: relative;
  z-index: 1;
}

.note-meta {
  font-size: 12px;
  color: #666;
  position: relative;
  z-index: 1;
}

.fab-container {
  position: fixed;
  bottom: calc(20px + env(safe-area-inset-bottom));
  right: 20px;
  z-index: 1000;
}

.fab {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: #000;
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  animation: fabPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes fabPop {
  0% { transform: scale(0); }
  70% { transform: scale(1.12); }
  100% { transform: scale(1); }
}

.fab:active {
  transform: scale(0.92);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.editor-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: #0f0f0f;
  z-index: 2000;
  display: none;
  flex-direction: column;
  animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
  }
  to {
    transform: translateY(0);
  }
}

.editor-modal.active {
  display: flex;
}

.editor-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  flex-shrink: 0;
}

.close-btn {
  background: none;
  border: none;
  color: #888;
  font-size: 24px;
  cursor: pointer;
  padding: 8px;
  margin: -8px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.close-btn:active {
  color: #fff;
  transform: scale(0.9);
}

.delete-modal-btn {
  background: none;
  border: none;
  color: #ff4444;
  font-size: 22px;
  cursor: pointer;
  padding: 8px;
  margin: -8px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.delete-modal-btn:active {
  transform: scale(0.9);
  color: #ff6666;
}

.editor-content {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 20px;
  display: flex;
  flex-direction: column;
}

.editor-title-input {
  font-size: 32px;
  font-weight: 700;
  border: none;
  outline: none;
  background: transparent;
  color: #fff;
  font-family: inherit;
  resize: none;
  -webkit-user-select: text;
  user-select: text;
  margin-bottom: 16px;
  line-height: 1.2;
}

.editor-title-input::placeholder {
  color: #444;
}

.editor-body-input {
  flex: 1;
  font-size: 16px;
  line-height: 1.6;
  border: none;
  outline: none;
  background: transparent;
  color: #ccc;
  font-family: inherit;
  resize: none;
  -webkit-user-select: text;
  user-select: text;
}

.editor-body-input::placeholder {
  color: #444;
}

.editor-timestamp {
  font-size: 12px;
  color: #666;
  text-align: center;
  margin-top: 24px;
  padding-bottom: 20px;
}

.delete-confirm-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  z-index: 3000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.delete-confirm-modal.active {
  display: flex;
}

.delete-confirm-box {
  background: #1a1a1a;
  border-radius: 20px;
  padding: 24px;
  max-width: 320px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.delete-confirm-title {
  font-size: 18px;
  font-weight: 700;
  color: #fff;
  margin-bottom: 8px;
}

.delete-confirm-text {
  font-size: 14px;
  color: #888;
  margin-bottom: 20px;
}

.delete-confirm-actions {
  display: flex;
  gap: 12px;
}

.delete-confirm-cancel {
  flex: 1;
  padding: 12px;
  background: rgba(255, 255, 255, 0.1);
  border: none;
  border-radius: 10px;
  color: #fff;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.delete-confirm-cancel:active {
  background: rgba(255, 255, 255, 0.15);
  transform: scale(0.98);
}

.delete-confirm-delete {
  flex: 1;
  padding: 12px;
  background: #ff4444;
  border: none;
  border-radius: 10px;
  color: #fff;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.delete-confirm-delete:active {
  background: #ff6666;
  transform: scale(0.98);
}

.note-item.deleting {
  animation: slideOutLeft 0.3s cubic-bezier(0.4, 0, 1, 1) forwards;
}

@keyframes slideOutLeft {
  to {
    opacity: 0;
    transform: translateX(-100%);
  }
}

::-webkit-scrollbar {
  display: none;
}

@media (max-width: 480px) {
  .header-title {
    font-size: 28px;
  }

  .note-item {
    padding: 14px;
  }

  .note-title {
    font-size: 16px;
  }

  .note-preview {
    font-size: 13px;
  }

  .editor-title-input {
    font-size: 28px;
  }

  .editor-body-input {
    font-size: 15px;
  }
}
</style>
</head>
<body>

<div id="app">
  <div class="header">
    <div class="header-title">Notes</div>
    <div class="header-right">
      <div class="note-stats" id="noteStats">0</div>
    </div>
  </div>

  <div class="notes-scroll">
    <div class="notes-grid" id="notesGrid">
      <div class="empty-state" id="emptyState">
        <div class="empty-icon">üìù</div>
        <div class="empty-title">No notes</div>
        <div class="empty-text">Tap + to create your first note</div>
      </div>
    </div>
  </div>

  <div class="fab-container">
    <button class="fab" id="fabBtn">+</button>
  </div>
</div>

<div class="editor-modal" id="editorModal">
  <div class="editor-header">
    <button class="close-btn" id="closeEditorBtn">√ó</button>
    <button class="delete-modal-btn" id="deleteNoteBtn">üóë</button>
  </div>
  <div class="editor-content">
    <textarea class="editor-title-input" id="editorTitle" placeholder="Note title" rows="1"></textarea>
    <textarea class="editor-body-input" id="editorBody" placeholder="Start typing..."></textarea>
    <div class="editor-timestamp" id="editorTime"></div>
  </div>
</div>

<div class="delete-confirm-modal" id="deleteConfirmModal">
  <div class="delete-confirm-box">
    <div class="delete-confirm-title">Delete note?</div>
    <div class="delete-confirm-text">This cannot be undone.</div>
    <div class="delete-confirm-actions">
      <button class="delete-confirm-cancel" id="cancelDeleteBtn">Cancel</button>
      <button class="delete-confirm-delete" id="confirmDeleteBtn">Delete</button>
    </div>
  </div>
</div>

<script>
const STORAGE_KEY = 'notes_data_v1';

let notes = [];
let currentNoteId = null;
let autoSaveTimer = null;

const DOM = {
  notesGrid: document.getElementById('notesGrid'),
  emptyState: document.getElementById('emptyState'),
  noteStats: document.getElementById('noteStats'),
  fabBtn: document.getElementById('fabBtn'),
  editorModal: document.getElementById('editorModal'),
  editorTitle: document.getElementById('editorTitle'),
  editorBody: document.getElementById('editorBody'),
  editorTime: document.getElementById('editorTime'),
  closeEditorBtn: document.getElementById('closeEditorBtn'),
  deleteNoteBtn: document.getElementById('deleteNoteBtn'),
  deleteConfirmModal: document.getElementById('deleteConfirmModal'),
  cancelDeleteBtn: document.getElementById('cancelDeleteBtn'),
  confirmDeleteBtn: document.getElementById('confirmDeleteBtn')
};

function loadNotes() {
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    notes = stored ? JSON.parse(stored) : [];
    notes.sort((a, b) => b.updatedAt - a.updatedAt);
  } catch (e) {
    notes = [];
  }
}

function saveNotes() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
  } catch (e) {
    console.error('Save failed:', e);
  }
}

function createNote() {
  const note = {
    id: Date.now() + Math.random(),
    title: '',
    body: '',
    createdAt: Date.now(),
    updatedAt: Date.now()
  };
  notes.unshift(note);
  saveNotes();
  return note;
}

function updateNote(id, title, body) {
  const note = notes.find(n => n.id === id);
  if (note) {
    note.title = title.trim();
    note.body = body.trim();
    note.updatedAt = Date.now();
    notes.sort((a, b) => b.updatedAt - a.updatedAt);
    saveNotes();
  }
}

function removeNote(id) {
  notes = notes.filter(n => n.id !== id);
  saveNotes();
}

function getRelativeTime(timestamp) {
  const now = Date.now();
  const diff = now - timestamp;
  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);

  if (seconds < 60) return 'Just now';
  if (minutes < 60) return `${minutes}m ago`;
  if (hours < 24) return `${hours}h ago`;
  if (days < 7) return `${days}d ago`;

  const date = new Date(timestamp);
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

function getFullTime(timestamp) {
  const date = new Date(timestamp);
  return date.toLocaleString('en-US', {
    month: 'short',
    day: 'numeric',
    year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined,
    hour: 'numeric',
    minute: '2-digit'
  });
}

function renderNotes() {
  DOM.notesGrid.innerHTML = '';

  if (notes.length === 0) {
    DOM.notesGrid.appendChild(DOM.emptyState);
    DOM.noteStats.textContent = '0';
    return;
  }

  DOM.noteStats.textContent = notes.length;

  notes.forEach(note => {
    const item = document.createElement('div');
    item.className = 'note-item';
    item.dataset.id = note.id;

    const title = note.title || 'Untitled';
    const preview = note.body || 'No content';

    item.innerHTML = `
      <div class="note-title">${escapeHtml(title)}</div>
      <div class="note-preview">${escapeHtml(preview)}</div>
      <div class="note-meta">${getRelativeTime(note.updatedAt)}</div>
    `;

    item.addEventListener('click', () => openEditor(note.id));
    DOM.notesGrid.appendChild(item);
  });
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function openEditor(noteId) {
  currentNoteId = noteId;
  const note = notes.find(n => n.id === noteId);

  if (!note) return;

  DOM.editorTitle.value = note.title;
  DOM.editorBody.value = note.body;
  DOM.editorTime.textContent = `Last edited ${getFullTime(note.updatedAt)}`;

  DOM.editorModal.classList.add('active');
  DOM.editorBody.focus();
}

function closeEditor() {
  DOM.editorModal.classList.remove('active');
  currentNoteId = null;
}

function autoSave() {
  if (currentNoteId) {
    const title = DOM.editorTitle.value;
    const body = DOM.editorBody.value;
    updateNote(currentNoteId, title, body);
    const note = notes.find(n => n.id === currentNoteId);
    DOM.editorTime.textContent = `Last edited ${getFullTime(note.updatedAt)}`;
  }
}

function scheduleAutoSave() {
  clearTimeout(autoSaveTimer);
  autoSaveTimer = setTimeout(autoSave, 600);
}

function openDeleteConfirm() {
  DOM.deleteConfirmModal.classList.add('active');
}

function closeDeleteConfirm() {
  DOM.deleteConfirmModal.classList.remove('active');
}

function performDelete() {
  if (!currentNoteId) return;

  const noteElement = document.querySelector(`[data-id="${currentNoteId}"]`);
  if (noteElement) {
    noteElement.classList.add('deleting');
  }

  setTimeout(() => {
    removeNote(currentNoteId);
    closeEditor();
    closeDeleteConfirm();
    renderNotes();
  }, 300);
}

DOM.fabBtn.addEventListener('click', () => {
  const note = createNote();
  renderNotes();
  openEditor(note.id);
});

DOM.closeEditorBtn.addEventListener('click', () => {
  autoSave();
  closeEditor();
  renderNotes();
});

DOM.deleteNoteBtn.addEventListener('click', openDeleteConfirm);
DOM.cancelDeleteBtn.addEventListener('click', closeDeleteConfirm);
DOM.confirmDeleteBtn.addEventListener('click', performDelete);

DOM.editorTitle.addEventListener('input', scheduleAutoSave);
DOM.editorBody.addEventListener('input', scheduleAutoSave);

document.addEventListener('contextmenu', (e) => {
  if (!e.target.closest('.editor-title-input, .editor-body-input')) {
    e.preventDefault();
  }
});

document.addEventListener('touchmove', (e) => {
  if (!e.target.closest('.notes-scroll, .editor-content, .delete-confirm-modal')) {
    e.preventDefault();
  }
}, { passive: false });

loadNotes();
renderNotes();
</script>

</body>
</html>
